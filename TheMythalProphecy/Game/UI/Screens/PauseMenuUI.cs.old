using Microsoft.Xna.Framework;
using Microsoft.Xna.Framework.Graphics;
using TheMythalProphecy.Game.UI.Components;
using System;

namespace TheMythalProphecy.Game.UI.Screens
{
    /// <summary>
    /// Pause menu with options for Inventory, Equipment, Status, Party, Save, Options, and Resume.
    /// </summary>
    public class PauseMenuUI : UIWindow
    {
        private UIPanel _menuPanel;
        private UIButton _resumeButton;
        private UIButton _inventoryButton;
        private UIButton _equipmentButton;
        private UIButton _statusButton;
        private UIButton _partyButton;
        private UIButton _saveButton;
        private UIButton _optionsButton;
        private UIButton _quitButton;

        public event Action OnResume;
        public event Action OnInventory;
        public event Action OnEquipment;
        public event Action OnStatus;
        public event Action OnParty;
        public event Action OnSave;
        public event Action OnOptions;
        public event Action OnQuit;

        public PauseMenuUI(int screenWidth, int screenHeight)
            : base(0, 0, 400, 500, "Pause Menu")
        {
            IsModal = true;
            ShowCloseButton = true;
            Center(screenWidth, screenHeight);

            BuildMenu();
        }

        private void BuildMenu()
        {
            _menuPanel = ContentPanel;
            _menuPanel.LayoutMode = LayoutMode.Vertical;
            _menuPanel.Spacing = 10f;

            // Resume
            _resumeButton = new UIButton(0, 0, 360, 50, "Resume");
            _resumeButton.OnClick += () =>
            {
                OnResume?.Invoke();
                Close();
            };
            _menuPanel.AddChild(_resumeButton);

            // Inventory
            _inventoryButton = new UIButton(0, 0, 360, 50, "Inventory");
            _inventoryButton.OnClick += () => OnInventory?.Invoke();
            _menuPanel.AddChild(_inventoryButton);

            // Equipment
            _equipmentButton = new UIButton(0, 0, 360, 50, "Equipment");
            _equipmentButton.OnClick += () => OnEquipment?.Invoke();
            _menuPanel.AddChild(_equipmentButton);

            // Status
            _statusButton = new UIButton(0, 0, 360, 50, "Status");
            _statusButton.OnClick += () => OnStatus?.Invoke();
            _menuPanel.AddChild(_statusButton);

            // Party
            _partyButton = new UIButton(0, 0, 360, 50, "Party");
            _partyButton.OnClick += () => OnParty?.Invoke();
            _menuPanel.AddChild(_partyButton);

            // Save
            _saveButton = new UIButton(0, 0, 360, 50, "Save Game");
            _saveButton.OnClick += () => OnSave?.Invoke();
            _menuPanel.AddChild(_saveButton);

            // Options
            _optionsButton = new UIButton(0, 0, 360, 50, "Options");
            _optionsButton.OnClick += () => OnOptions?.Invoke();
            _menuPanel.AddChild(_optionsButton);

            // Quit to Title
            _quitButton = new UIButton(0, 0, 360, 50, "Quit to Title");
            _quitButton.OnClick += () => OnQuit?.Invoke();
            _menuPanel.AddChild(_quitButton);

            OnClose += () => OnResume?.Invoke();
        }

        public override void Update(GameTime gameTime)
        {
            base.Update(gameTime);

            // ESC or Back button closes menu
            var input = Core.GameServices.Input;
            if (IsVisible && input.IsActionPressed("Cancel"))
            {
                Close();
                OnResume?.Invoke();
            }
        }
    }
}
